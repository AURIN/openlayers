<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Seamless tiled GeoJSON or TopoJSON</title>
<link rel="stylesheet" href="../theme/default/style.css" type="text/css">
<link rel="stylesheet" href="style.css" type="text/css">
<style type="text/css">
#controlToggle li {
	list-style: none;
}
</style>
<script src="../lib/OpenLayers.js"></script>
<script type="text/javascript">
  var mapTile, mapTopo, drawControls;
  var epsg4326 = new OpenLayers.Projection('EPSG:4326');
  var epsg900913 = new OpenLayers.Projection('EPSG:900913');
  
  function init() {
    mapTile = new OpenLayers.Map('mapTile', {
      displayProjection : epsg900913
    });

    // OpenStreetMap base layer with numZoomLevels set to number of data levels provided with this example
    var baseLayer = new OpenLayers.Layer.OSM("OpenStreetmap", [
        'http://a.tile.stamen.com/toner/${z}/${x}/${y}.png',
        'http://b.tile.stamen.com/toner/${z}/${x}/${y}.png',
        'http://c.tile.stamen.com/toner/${z}/${x}/${y}.png' ], {
      minZoomLevel : 4,
      maxZoomLevel : 17,
      projection : epsg900913
    });
    mapTile.addLayer(baseLayer);

    // Tiled layer (in orange)
    var tileLayer = new OpenLayers.Layer.SeamlessGeoJSON("State TopoJSON",
//        "http://localhost:2005/layers/ste/${z}/${x}/${y}.topojson", {
        "https://dev-api.aurin.org.au/vts/layers/ste/${z}/${x}/${y}.topojson", {
          projection : epsg900913,
          format : "topojson",
          initialdelay: 500,
          tileloaddelay: 400,
          minZoomLevel : 0,
          maxZoomLevel : 20,
          styleMap: new OpenLayers.StyleMap({default:  new OpenLayers.Style({
            strokeColor : "#FF9933",
            fill : true,
            fillOpacity : 0.2,
            fillColor : "#FF9933"
          }),
            select:  new OpenLayers.Style({
              strokeColor : "#66FFFF",
              fill : true,
              fillOpacity : 0.2,
              fillColor : "#66FFFF"
            })
          })
        });
    mapTile.addLayer(tileLayer);

    // GeoJSON line tiled layer (drawn in green), visible only for Victoria at high zoom levels
    /* FIXME: #2828
    var streetLayer = new OpenLayers.Layer.SeamlessGeoJSON("Streets",
        "http://localhost/vts/layers/street/${z}/${x}/${y}.json", {
          projection : epsg900913,
          format : "json",
          initialdelay: 500,
          tileloaddelay: 400,
          minZoomLevel : 15,
          maxZoomLevel : 20,
          styleMap: new OpenLayers.StyleMap({default:  new OpenLayers.Style({
              strokeColor : "#99FF99",
              strokeWidth : 4,
              fill: false
          }),
            select:  new OpenLayers.Style({
              strokeColor : "#66FFFF",
              fill: false
            })
          })
        });
    mapTile.addLayer(streetLayer);
    */
    
    mapTile.addControl(new OpenLayers.Control.Navigation({
      dragPanOptions : {
        enableKinetic : true
      }
    }));
    
    var report = function(e) {
      OpenLayers.Console.log(e.type, e.feature.id);
    };
  
    var highlightCtrl = new OpenLayers.Control.SelectFeature(tileLayer.featureLayer, {
      hover: true,
      highlightOnly: true,
      renderIntent: "temporary",
      eventListeners: {
          beforefeaturehighlighted: report,
          featurehighlighted: report,
          featureunhighlighted: report
      }
    });

    var selectCtrl = new OpenLayers.Control.SelectFeature(tileLayer.featureLayer,
      {clickout: true}
    );

    mapTile.addControl(highlightCtrl);
    mapTile.addControl(selectCtrl);

    highlightCtrl.activate();
    selectCtrl.activate();
    
    mapTile.setCenter(new OpenLayers.LonLat(135, -30).transform(epsg4326,
        epsg900913), 4);
  }
    
</script>
</head>
<body onload="init()">
	<h1 id="title">Seamless tiled GeoJSON and TopoJSON</h1>
	<div id="tags">vector, geojson, topojson, feature, selecting,
		selection, popup</div>
	<p id="shortdesc">This shows how to use
		OpenLayers.Layer.SeeamlessGeoJSON to present tiled vector data.</p>
	<div id="mapTile"
		style="width: 700px; height: 600px; border: 1px solid #ccc;"></div>
</body>
</html>
