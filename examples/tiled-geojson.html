<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Seamless tiled GeoJSON or TopoJSON</title>
<link rel="stylesheet" href="../theme/default/style.css" type="text/css">
<link rel="stylesheet" href="style.css" type="text/css">
<style type="text/css">
#controlToggle li {
	list-style: none;
}
</style>
<script src="../lib/OpenLayers.js"></script>
<script type="text/javascript">
  var mapTile, mapTopo, drawControls;
  var epsg4326 = new OpenLayers.Projection('EPSG:4326');
  var epsg900913 = new OpenLayers.Projection('EPSG:900913');
  
  function init() {
    mapTile = new OpenLayers.Map('mapTile', {
      displayProjection : epsg900913
    });

    // OpenStreetMap base layer with numZoomLevels set to number of data levels provided with this example
    var baseLayer = new OpenLayers.Layer.OSM("OpenStreetmap", [
        'http://a.tile.stamen.com/toner/${z}/${x}/${y}.png',
        'http://b.tile.stamen.com/toner/${z}/${x}/${y}.png',
        'http://c.tile.stamen.com/toner/${z}/${x}/${y}.png' ], {
      minZoomLevel : 4,
      maxZoomLevel : 17,
      projection : epsg900913
    });
    mapTile.addLayer(baseLayer);

    // Tiled layer (in orange)
    var maxExtent= new OpenLayers.Bounds([140, -40, 170, -10]); // see #2972 
    maxExtent.transform(epsg4326, epsg900913); // see #2972 
    var tileLayer = new OpenLayers.Layer.SeamlessGeoJSON("CD TopoJSON",
        "http://localhost:2005/layers/lga/${z}/${x}/${y}.topojson", {
//        "https://dev-api.aurin.org.au/vts/layers/lga/${z}/${x}/${y}.topojson", {
          projection : epsg900913,
          format : "topojson",
          initialdelay: 500,
          tileloaddelay: 400,
          minZoomLevel : 0,
          maxZoomLevel : 20,
//          maxExtent: maxExtent, FIXME: this prevents any feature to be displayed, see #2972                        
          strategies: [
            new OpenLayers.Strategy.Filter({filter: new OpenLayers.Filter.FeatureId({ 
            fids: ["10050",
                   "10110",
                   "10150",
                   "10200",
                   "10250",
                   "10300",
                   "10350",
                   "10470",
                   "10500",
                   "10550",
                   "10600",
                   "10650",
                   "10750",
                   "10800",
                   "10850",
                   "10900",
                   "10950",
                   "11000",
                   "11050",
                   "11100",
                   "11150",
                   "11200",
                   "11250",
                   "11300",
                   "11350",
                   "11400",
                   "11450",
                   "11500",
                   "11520",
                   "11550",
                   "11600",
                   "11700",
                   "11720",
                   "11730",
                   "11750",
                   "11800",                   
                   "11860", 
                   "12000",
                   "12050",
                   "12150",
                   "12200",
                   "12300",
                   "12350",
                   "12500",
                   "12600",
                   "12700",
                   "12750",
                   "12850",
                   "12900",
                   "12950",
                   "13010",
                   "13050",
                   "13100",
                   "13310",
                   "13350",
                   "13370",
                   "13400",
                   "13450",
                   "13500",
                   "13550",
                   "13650",
                   "13660",
                   "13700",
                   "13750",
                   "13800",
                   "13850",
                   "13950",
                   "14000",
                   "14100",
                   "14150",
                   "14200",
                   "14250",
                   "14300",
                   "14350",
                   "14400",
                   "14450",
                   "14500",
                   "14550",
                   "14600",
                   "14650",
                   "14700",
                   "14750",
                   "14800",
                   "14850",
                   "14870",
                   "14900",
                   "14920",
                   "14950",
                   "15050",
                   "15150",
                   "15200",
                   "15270",
                   "15300",
                   "15350",
                   "15500",
                   "15550",
                   "15650",
                   "15700",
                   "15750",
                   "15800",
                   "15850",
                   "15900",
                   "15950",
                   "16100",
                   "16150",
                   "16180",
                   "16200",
                   "16250",
                   "16350",
                   "16370",
                   "16400",
                   "16470",
                   "16550",
                   "16610",
                   "16650",
                   "16700",
                   "16900",
                   "16950",
                   "17000",
                   "17050",
                   "17100",
                   "17150",
                   "17200",
                   "17310",
                   "17350",
                   "17400",
                   "17450",
                   "17500",
                   "17550",
                   "17620",
                   "17640",
                   "17650",
                   "17700",
                   "17750",
                   "17800",
                   "17850",
                   "17900",
                   "17950",
                   "18000",
                   "18020",
                   "18050",
                   "18100",
                   "18150",
                   "18200",
                   "18250",
                   "18350",
                   "18400",
                   "18450",
                   "18500",
                   "18550",
                   "18710",
                   "18750",
                   "19399"
                   ] 
          })})],
          styleMap: new OpenLayers.StyleMap({default:  new OpenLayers.Style({
            strokeColor : "#FF9933",
            fill : true,
            fillOpacity : 0.2,
            fillColor : "#FF9933"
          }),
            select:  new OpenLayers.Style({
              strokeColor : "#66FFFF",
              fill : true,
              fillOpacity : 0.2,
              fillColor : "#66FFFF"
            })
          })
        });
    mapTile.addLayer(tileLayer);

    // GeoJSON line tiled layer (drawn in green), visible only for Victoria at high zoom levels
    /* FIXME: #2828
    var streetLayer = new OpenLayers.Layer.SeamlessGeoJSON("Streets",
        "http://localhost/vts/layers/street/${z}/${x}/${y}.json", {
          projection : epsg900913,
          format : "json",
          initialdelay: 500,
          tileloaddelay: 400,
          minZoomLevel : 15,
          maxZoomLevel : 20,
          styleMap: new OpenLayers.StyleMap({default:  new OpenLayers.Style({
              strokeColor : "#99FF99",
              strokeWidth : 4,
              fill: false
          }),
            select:  new OpenLayers.Style({
              strokeColor : "#66FFFF",
              fill: false
            })
          })
        });
    mapTile.addLayer(streetLayer);
    */
    
    mapTile.addControl(new OpenLayers.Control.Navigation({
      dragPanOptions : {
        enableKinetic : true
      }
    }));
    
    var report = function(e) {
      OpenLayers.Console.log(e.type, e.feature.id);
    };
  
    var highlightCtrl = new OpenLayers.Control.SelectFeature(tileLayer.featureLayer, {
      hover: true,
      highlightOnly: true,
      renderIntent: "temporary",
      eventListeners: {
          beforefeaturehighlighted: report,
          featurehighlighted: report,
          featureunhighlighted: report
      }
    });

    var selectCtrl = new OpenLayers.Control.SelectFeature(tileLayer.featureLayer,
      {clickout: true}
    );

    mapTile.addControl(highlightCtrl);
    mapTile.addControl(selectCtrl);

    highlightCtrl.activate();
    selectCtrl.activate();
    
    mapTile.setCenter(new OpenLayers.LonLat(135, -30).transform(epsg4326,
        epsg900913), 4);
  }
    
</script>
</head>
<body onload="init()">
	<h1 id="title">Seamless tiled GeoJSON and TopoJSON</h1>
	<div id="tags">vector, geojson, topojson, feature, selecting,
		selection, popup</div>
	<p id="shortdesc">This shows how to use
		OpenLayers.Layer.SeeamlessGeoJSON to present tiled vector data.</p>
	<div id="mapTile"
		style="width: 700px; height: 600px; border: 1px solid #ccc;"></div>
</body>
</html>
